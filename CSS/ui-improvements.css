/* Improve alignment, spacing, typography, mobile friendliness and visual emphasis.
   Add after ui.css and ui-theme.css:
   <link href="CSS/ui-improvements.css" rel="stylesheet">
*/

/* Base responsive type scale */
:root{
  --base-font: 15px;
}
html { font-size: var(--base-font); }
@media (max-width:420px){ :root{ --base-font:14px } }
@media (min-width:1024px){ :root{ --base-font:16px } }

/* --- Font size presets (Settings control toggles these classes on <html>) --- */
html.size-small  { --base-font: 14px; }   /* small: current size (or slightly smaller) */
html.size-medium { --base-font: 15px; }   /* medium: a bit bigger */
html.size-large  { --base-font: 17px; }   /* large: noticeably bigger */

/* Readability & content width */
.container.page-shell { max-width: 920px; margin: 0 auto; padding-left: 14px; padding-right: 14px; }

/* Header alignment improvements */
.app-header { align-items:center; gap:12px; padding:10px 14px; }
.app-header .app-title { font-size:1.05rem; letter-spacing:0.2px; }
.app-header .d-flex { align-items:center; }

/* Make header buttons larger tappable on mobile */
.app-header .btn { width:40px; height:40px; border-radius:10px; }
@media (max-width:420px){ .app-header .btn { width:44px; height:44px; } }

/* Stat cards / KPIs */
.stat-card { display:flex; flex-direction:column; justify-content:center; min-height:86px; padding:12px; }
.stat-value { font-size:1.2rem; line-height:1; }
.stat-label { font-size:12px; text-transform:uppercase; letter-spacing:0.04em; }

/* KPI utilities */
.kpi { display:flex; align-items:baseline; gap:8px; }
.kpi .kpi-label { font-size:12px; color:var(--muted); font-weight:700; }
.kpi .kpi-value { font-size:20px; font-weight:900; }
.kpi .kpi-value.positive { color:var(--profit); }
.kpi .kpi-value.negative { color:var(--loss); }

/* Improve card & list spacing */
.panel { padding:0; overflow:visible; }
.panel-head { padding:12px 14px; display:flex; align-items:center; justify-content:space-between; gap:8px; }
.panel-body { padding:12px 14px 16px; }

/* TXN / list cards - improved vertical rhythm */
.txn-card { padding:12px 14px; margin-bottom:10px; border-radius:12px; }
.txn-card .txn-name { font-size:15px; }
.txn-card .tiny-label { font-size:12px; }

/* Tables: increase touch targets + responsive stacking on very small screens */
.table.table-sm th, .table.table-sm td { padding:10px 8px; font-size:13px; }
.table-responsive { overflow-x:auto; -webkit-overflow-scrolling:touch; }
@media (max-width:520px){
  .table thead { display:none; }
  .table tbody tr { display:block; border:1px solid var(--border); border-radius:10px; margin-bottom:8px; padding:8px; }
  .table tbody td { display:flex; justify-content:space-between; padding:6px 4px; }
  .table tbody td::before { content: attr(data-label); color:var(--muted); font-weight:700; margin-right:8px; }
}

/* Buttons & form controls: larger tap areas */
.form-control, .form-select { min-height:44px; padding:10px 12px; border-radius:12px; }
.btn, .btn-primary, .btn-outline-primary { min-height:44px; border-radius:12px; padding-left:12px; padding-right:12px; }

/* Bottom nav: larger icons and spacing */
.bottom-nav { padding:8px 0; gap:6px; }
.bottom-nav a { padding:8px 6px; }
.bottom-nav a i { font-size:18px; }

/* Emphasis colors (consistent) */
.metric-strong.profit, .kpi .kpi-value.positive { color: var(--profit) !important; }
.metric-strong.loss, .kpi .kpi-value.negative { color: var(--loss) !important; }

/* Badges & pills: stronger contrast */
.status-pill-mini { box-shadow:none; padding:4px 8px; font-weight:800; }
.status-pill-mini.ok { background: rgba(34,197,94,0.12); color: var(--profit); }
.status-pill-mini.bad { background: rgba(220,64,58,0.08); color: var(--loss); }

/* Focus & accessibility: visible outlines for keyboard users */
:focus { outline: 3px solid rgba(13,110,253,0.14); outline-offset:2px; }

/* Small utility classes */
.u-bold { font-weight:800; }
.u-muted { color:var(--muted); }
.u-small { font-size:12px; }
.u-center { text-align:center; }

/* Ensure JS-rendered values pick up theme semantics */
.u-profit { color: var(--profit) !important; font-weight:800; }
.u-loss { color: var(--loss) !important; font-weight:800; }
.u-warn { color: var(--warn) !important; font-weight:700; }

/* stronger metric emphasis for cards */
.metric-strong { letter-spacing: -0.01em; }
.metric-strong.profit { color: var(--profit) !important; }
.metric-strong.loss { color: var(--loss) !important; }

/* small compatibility: ensure `.data-negative` class (used in templates) is styled */
.data-negative { color: var(--loss) !important; font-weight:800; }

/* Improve modal / details visibility on small screens */
.txn-table table { width:100%; border-collapse:collapse; font-size:13px; }
.txn-table th, .txn-table td { padding:8px; border-bottom:1px solid var(--border); }

/* Slight animation to make toggles feel responsive */
.icon-toggle-btn { transition: transform 120ms ease; }
.icon-toggle-btn:active { transform: scale(0.98); }

/* Dark-mode subtle fixes */
body.dark .txn-card { background: color-mix(in oklab, var(--card) 92%, #071226); border-color: rgba(255,255,255,0.04); }
body.dark .stat-card { background: color-mix(in oklab, var(--card) 92%, #071226); }

/* Mobile-first improvements: reduce dense text & increase spacing */
@media (max-width:420px){
  .txn-card { padding:12px; }
  .panel-head { padding:10px; }
  .hero-title { font-size:1.01rem; }
}

/* --- Semantic color enforce (last-resort overrides) --- */
.profit,
.metric-strong.profit,
.data-highlight.positive,
.kpi .kpi-value.positive {
  color: var(--profit) !important;
  font-weight: 800;
}
.loss,
.metric-strong.loss,
.data-highlight.negative,
.kpi .kpi-value.negative {
  color: var(--loss) !important;
  font-weight: 800;
}

/* --- Header & icon contrast (ensure icons visible in dark mode) --- */
.app-header .btn i,
.app-header .btn svg {
  color: var(--text) !important;
}
body.dark .app-header .btn i,
body.dark .app-header .btn svg {
  color: var(--text) !important;
}

/* Bottom nav icons contrast */
.bottom-nav a i,
.bottom-nav a {
  color: var(--muted);
}
body.dark .bottom-nav a,
body.dark .bottom-nav a i {
  color: var(--muted) !important;
}
.bottom-nav a.active { color: var(--accent) !important; font-weight:700; }

/* --- Insights dark-mode readability fixes --- */
body.dark .page-insights .panel,
body.dark .page-insights .txn-card,
body.dark .page-insights .hero {
  background: color-mix(in oklab, var(--card) 92%, #071226);
  border-color: color-mix(in oklab, var(--border) 86%, #1b2a44);
}
body.dark .page-insights .panel-head {
  background: color-mix(in oklab, var(--card) 90%, #102033);
  color: #d9e7fa;
}

/* --- Mobile: keep desktop table structure (allow horizontal scroll) --- */
@media (max-width: 520px) {
  .table thead { display: table-header-group !important; }
  .table tbody tr { display: table-row !important; }
  .table tbody td { display: table-cell !important; white-space: nowrap; }
  .table-responsive { overflow-x: auto; -webkit-overflow-scrolling: touch; }
}

/* Ensure .data-negative / .data-highlight variants rendered correctly everywhere */
.data-negative { color: var(--loss) !important; font-weight:800; }
.data-highlight.positive { color: var(--profit) !important; }
.data-highlight.negative { color: var(--loss) !important; }

/* Move / enforce small per-page inline rules here so nothing blocks */
.loss-value {
  color: var(--loss) !important;
  font-weight: 800;
}

/* clickable rows used across several pages (LossReport, TradeQuality) */
.row-clickable { cursor: pointer; }
.row-clickable:hover { background: color-mix(in oklab, var(--card) 87%, #e8f1ff); }

/* TradeQuality: table row hover and pointer (mobile & desktop consistent) */
#tqTable tbody tr { cursor: pointer; }
#tqTable tbody tr:hover { background: color-mix(in oklab, var(--card) 87%, #e8f1ff); }

/* txn-table spacing used by LossReport and TradeQuality transaction lists */
.txn-table { margin-top: 10px; }

/* Ensure profit/loss values are always applied (last-resort enforcement) */
.profit, .metric-strong.profit, .data-highlight.positive, .u-profit {
  color: var(--profit) !important;
  font-weight: 800;
}
.loss, .metric-strong.loss, .data-highlight.negative, .u-loss {
  color: var(--loss) !important;
  font-weight: 800;
}

/* Ensure icons in header and bottom nav remain visible in dark mode */
.app-header .btn i, .app-header .btn svg,
.bottom-nav a i, .bottom-nav a {
  color: var(--text) !important;
}
body.dark .app-header .btn i,
body.dark .bottom-nav a i {
  color: var(--text) !important;
}

/* Keep desktop table structure on small screens but allow horizontal scroll */
.table-responsive { overflow-x: auto; -webkit-overflow-scrolling: touch; }
@media (max-width: 520px) {
  .table thead { display: table-header-group !important; }
  .table tbody tr { display: table-row !important; }
  .table tbody td { display: table-cell !important; white-space: nowrap; }
}

/* Keep this file additive and minimal â€” override or tune specific selectors if required. */

/* Hard-enforce bottom nav fixed placement on mobile */
.bottom-nav {
  position: fixed !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  z-index: 9999 !important;
  padding-bottom: max(8px, env(safe-area-inset-bottom, 0px)) !important;
}

body {
  padding-bottom: calc(88px + env(safe-area-inset-bottom, 0px)) !important;
}

/* Mobile-first header layout: user/title on first row, action icons on second row */
@media (max-width: 820px) {
  .app-header {
    display: flex !important;
    flex-wrap: wrap !important;
    align-items: center !important;
    row-gap: 8px !important;
  }
  .app-header .app-title {
    width: 100% !important;
    margin: 0 !important;
    font-size: 1.35rem !important;
    line-height: 1.2;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  .app-header .d-flex {
    width: 100% !important;
    display: flex !important;
    justify-content: flex-start !important;
    flex-wrap: wrap !important;
    gap: 8px !important;
  }
}

/* Keep fixed bottom navigation visually stable across all pages */
.bottom-nav {
  width: 100% !important;
  max-width: 100vw !important;
  min-height: 62px;
  box-shadow: 0 -6px 20px rgba(0, 0, 0, 0.06);
}
.bottom-nav a {
  min-width: 56px;
}

/* Cloud status modal polish for mobile */
.cloud-status-modal {
  position: fixed;
  inset: 0;
  background: rgba(6, 10, 18, 0.45);
  display: none;
  z-index: 10000;
  padding: 14px;
}
.cloud-status-card {
  width: min(96vw, 560px);
  margin: 8vh auto 0;
  background: var(--card);
  color: var(--text);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 14px;
  box-shadow: 0 16px 40px rgba(0, 0, 0, 0.22);
}
@media (max-width: 520px) {
  .cloud-status-modal {
    padding: 10px;
  }
  .cloud-status-card {
    margin: 2vh auto 0;
    width: 100%;
    border-radius: 12px;
  }
}

/* Shared app dialogs (replace alert/confirm/prompt) */
.app-dialog-backdrop {
  position: fixed;
  inset: 0;
  z-index: 11050;
  background: rgba(7, 12, 24, 0.48);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 14px;
}
.app-dialog-card {
  width: min(94vw, 440px);
  background: var(--card);
  color: var(--text);
  border: 1px solid var(--border);
  border-radius: 14px;
  box-shadow: 0 16px 40px rgba(0, 0, 0, 0.24);
  padding: 14px;
}
.app-dialog-title {
  font-weight: 800;
  margin-bottom: 8px;
}
.app-dialog-message {
  color: var(--text);
  white-space: pre-wrap;
  margin-bottom: 10px;
}
.app-dialog-input {
  margin-bottom: 8px;
}
.app-dialog-error {
  color: #dc2626;
  font-size: 12px;
  margin-bottom: 8px;
}
.app-dialog-actions {
  display: flex;
  justify-content: flex-end;
  gap: 8px;
  margin-top: 8px;
}

/* Blocking loading overlay for logout/passkey/restore */
.app-loading-overlay {
  position: fixed;
  inset: 0;
  z-index: 11100;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(7, 12, 24, 0.5);
  padding: 16px;
}
.app-loading-card {
  min-width: 220px;
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 14px;
  box-shadow: 0 16px 40px rgba(0, 0, 0, 0.22);
  padding: 14px;
  display: flex;
  align-items: center;
  gap: 10px;
}
.app-loading-text {
  font-weight: 700;
}
.app-loading-spinner {
  width: 18px;
  height: 18px;
  border-radius: 50%;
  border: 2px solid color-mix(in oklab, var(--border) 70%, transparent);
  border-top-color: var(--blue);
  animation: app-spin 0.8s linear infinite;
}
@keyframes app-spin {
  to { transform: rotate(360deg); }
}
